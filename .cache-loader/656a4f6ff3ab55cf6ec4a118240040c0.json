{"remainingRequest":"/Users/jiachen/projects/shared_diary/node_modules/_babel-loader@8.0.6@babel-loader/lib/index.js!/Users/jiachen/projects/shared_diary/src/packages/order/index.js","dependencies":[{"path":"/Users/jiachen/projects/shared_diary/src/packages/order/index.js","mtime":1574666290469},{"path":"/Users/jiachen/projects/shared_diary/node_modules/_cache-loader@1.2.5@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/jiachen/projects/shared_diary/node_modules/_babel-loader@8.0.6@babel-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import { api, request } from 'utils/api';\nimport Toast from 'vant-weapp/dist/toast/toast';\nimport Config from 'utils/config';\nconst app = getApp();\nPage({\n  data: {\n    productList: [],\n    vip: '/slice/membership/membership.png',\n    price: 0,\n    couponId: '',\n    coupon: null,\n    userNote: '',\n    assetsUrl: Config.assetsUrl\n  },\n\n  onLoad() {\n    console.log(app.globalData.orderInfo);\n    const {\n      productList,\n      orderProductList,\n      totalPrice,\n      totalOriginPrice,\n      orderId\n    } = app.globalData.orderInfo;\n    this.orderProductList = orderProductList;\n    this.setData({\n      id: orderId,\n      productList,\n      totalOriginPrice,\n      totalPrice,\n      price: totalPrice\n    });\n  },\n\n  onShow() {\n    if (app.globalData.isSetCoupon === true) {\n      app.globalData.isSetCoupon = false;\n      this.setData({\n        couponId: app.globalData.coupon.id,\n        coupon: app.globalData.coupon\n      });\n    }\n\n    if (this.data.coupon && this.data.totalPrice) {\n      const {\n        type,\n        amount,\n        discount\n      } = this.data.coupon;\n      let {\n        totalPrice,\n        price\n      } = this.data;\n      price = totalPrice;\n\n      if (type === 1) {\n        price = price * discount / 100;\n      } else {\n        price -= amount;\n      }\n\n      if (price < 0) {\n        price = 0;\n      }\n\n      this.setData({\n        price\n      });\n    }\n  },\n\n  bindReplaceInput(e) {\n    this.setData({\n      userNote: e.detail.value\n    });\n  },\n\n  navToCounpon() {\n    wx.navigateTo({\n      url: '/packages/wallet/index?select=1'\n    });\n  },\n\n  onClickBuy() {\n    console.log('准备支付： ', this.orderProductList);\n    const that = this;\n    request({\n      id: this.data.id,\n      ...api.order_pay\n    }, {\n      user_note: this.data.userNote,\n      coupon_id: this.data.couponId,\n      order_product_list: this.orderProductList\n    }).then(res => {\n      let result = res.payArgs;\n      wx.requestPayment({\n        timeStamp: result.timeStamp,\n        nonceStr: result.nonceStr,\n        package: result.package,\n        signType: result.signType,\n        paySign: result.paySign,\n\n        success(res) {\n          if (res) {\n            wx.redirectTo({\n              url: '/packages/success/index?isNext=1&orderId=' + that.data.id\n            });\n          }\n        },\n\n        fail() {\n          Toast('微信支付失败');\n        }\n\n      });\n    }).catch(err => {\n      Toast(err && err.message || err && err.msg || err || '支订单付款失败');\n    });\n  },\n\n  onShareAppMessage() {\n    return {\n      title: '爱戴小盒，快来看看吧!',\n      path: '/pages/entry/index',\n      imageUrl: 'http://static.wx.qiaqiabox.com/slice/share/1.jpeg'\n    };\n  }\n\n});",null]}