{"remainingRequest":"/Users/jiachen/projects/shared_diary/node_modules/_babel-loader@8.0.6@babel-loader/lib/index.js!/Users/jiachen/projects/shared_diary/src/packages/address/edit/index.js","dependencies":[{"path":"/Users/jiachen/projects/shared_diary/src/packages/address/edit/index.js","mtime":1574680585677},{"path":"/Users/jiachen/projects/shared_diary/node_modules/_cache-loader@1.2.5@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/jiachen/projects/shared_diary/node_modules/_babel-loader@8.0.6@babel-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import { getAddressInfo, createAddress, updateAddress } from './api';\nimport { toSnakeCase } from 'shared/utils/map-keys';\nimport Toast from 'vant-weapp/dist/toast/toast';\nimport areaList from './area';\nconst app = getApp();\nPage({\n  data: {\n    areaList,\n    isDefault: false,\n    showSelectArea: false,\n    address: {\n      addressName: '',\n      company: '',\n      province: '',\n      city: '',\n      county: '',\n      address: '',\n      name: '',\n      phone: '',\n      isDefault: 0\n    },\n    addressStr: ''\n  },\n\n  onLoad(query = {}) {\n    this.lock = false;\n    let {\n      address\n    } = query;\n\n    if (address) {\n      address = JSON.parse(address);\n      this.id = address.id;\n      this.setData({\n        address\n      });\n    }\n  },\n\n  onClickDefaultBtn() {\n    const isDefault = !this.data.address.isDefault ? 1 : 0;\n    this.setData({\n      'address.isDefault': isDefault\n    });\n  },\n\n  onClickSelectArea() {\n    this.setData({\n      showSelectArea: true\n    });\n  },\n\n  onAreaCancel() {\n    this.setData({\n      showSelectArea: false\n    });\n  },\n\n  onAreaConfirm(e) {\n    const {\n      values\n    } = e.detail;\n    const province = values[0].name;\n    const city = values[1].name;\n    const county = values[2].name;\n    const addressName = province + ' ' + city + ' ' + county;\n    this.setData({\n      showSelectArea: false,\n      'address.province': province,\n      'address.city': city,\n      'address.county': county,\n      'address.addressName': addressName\n    });\n  },\n\n  onNameInput(e) {\n    this.setData({\n      'address.name': e.detail\n    });\n  },\n\n  onPhoneInput(e) {\n    this.setData({\n      'address.phone': e.detail\n    });\n  },\n\n  onAddressInput(e) {\n    this.setData({\n      'address.address': e.detail\n    });\n  },\n\n  onSave() {\n    if (this.lock) {\n      return;\n    }\n\n    const {\n      address\n    } = this.data;\n    const keys = Object.keys(address);\n\n    for (let i = 0; i < keys.length; i++) {\n      const key = keys[i];\n\n      if (key !== 'company' && key !== 'isDefault' && !address[key]) {\n        return Toast('请完善信息');\n      }\n    }\n\n    this.lock = true;\n    let handle = null;\n\n    if (!this.id) {\n      handle = createAddress(address);\n    } else {\n      handle = updateAddress(this.id, address);\n    }\n\n    handle.then(() => {\n      Toast('保存成功');\n      this.navigateBack();\n    }).catch(() => {\n      this.lock = false;\n    });\n  },\n\n  navigateBack() {\n    app.globalData.refreshAddressList = true;\n    setTimeout(() => wx.navigateBack(), 1500);\n  },\n\n  onShareAppMessage() {\n    return {\n      title: '爱戴小盒，快来看看吧!',\n      path: '/pages/entry/index',\n      imageUrl: 'http://static.wx.qiaqiabox.com/slice/share/1.jpeg'\n    };\n  }\n\n});",null]}