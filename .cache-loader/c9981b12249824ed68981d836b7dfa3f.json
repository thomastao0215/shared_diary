{"remainingRequest":"/Users/jiachen/projects/shared_diary/node_modules/_babel-loader@8.0.6@babel-loader/lib/index.js!/Users/jiachen/projects/shared_diary/src/packages/membership/index.js","dependencies":[{"path":"/Users/jiachen/projects/shared_diary/src/packages/membership/index.js","mtime":1574666290468},{"path":"/Users/jiachen/projects/shared_diary/node_modules/_cache-loader@1.2.5@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/jiachen/projects/shared_diary/node_modules/_babel-loader@8.0.6@babel-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import { api, request } from 'utils/api';\nimport Toast from 'vant-weapp/dist/toast/toast';\nconst app = getApp();\nPage({\n  data: {\n    imgUrls: [// 'http://static.wx.qiaqiabox.com/slice/membership/halfyear.png',\n    'http://static.wx.qiaqiabox.com/slice/membership/chuzhi2.png'],\n    titles: [// '开通会员，立享体验',\n    '立享体验'],\n    titles2: [// 'TRY IT NOW',\n    'JOIN THE VIP CLUB'],\n    originPrice: 9.9,\n    price: 9.9,\n    type: 12,\n    code: '',\n    cardType: [{\n      type: 12,\n      price: 9.9\n    }],\n    current: 0\n  },\n\n  onLoad() {// request(api.info)\n    //   .then(res => {\n    //     if (res.user.status === 2 || res.user.status === 4) {\n    //       wx.switchTab({ url: '/pages/box/index' })\n    //     }\n    //   })\n  },\n\n  onShow() {\n    if (app.globalData.isSetCoupon === true) {\n      app.globalData.isSetCoupon = false;\n      this.setData({\n        coupon: app.globalData.coupon\n      });\n    }\n  },\n\n  bindChange(e) {\n    var current = e.detail.current;\n    this.setData({\n      current,\n      type: this.data.cardType[current].type,\n      price: this.data.cardType[current].price,\n      originPrice: this.data.cardType[current].price\n    });\n  },\n\n  bindCodeChange(e) {\n    this.setData({\n      code: e.detail.value\n    });\n  },\n\n  applyCode() {\n    if (!this.data.code) {\n      return;\n    }\n\n    request({\n      id: '?code=' + this.data.code,\n      ...api.get_coupon_for_subscribe\n    }, {\n      subscription_type: this.data.type,\n      code: this.data.code\n    }).then(res => {\n      console.log(res.coupon_for_subscribe);\n      const {\n        originPrice\n      } = this.data;\n      this.setData({\n        price: originPrice * res.coupon_for_subscribe.discount / 100\n      });\n    }).catch(err => {\n      Toast(err.message);\n    });\n  },\n\n  bindUseCode() {},\n\n  payMember() {\n    request({ ...api.subscribe_pay\n    }, {\n      subscription_type: this.data.type,\n      code: this.data.code\n    }).then(res => {\n      let result = res.payArgs;\n      wx.requestPayment({\n        timeStamp: result.timeStamp,\n        nonceStr: result.nonceStr,\n        package: result.package,\n        signType: result.signType,\n        paySign: result.paySign,\n\n        success(res) {\n          if (res) {\n            wx.redirectTo({\n              url: '/packages/success/index'\n            });\n          }\n        },\n\n        fail() {\n          Toast('微信支付失败');\n        }\n\n      });\n    }).catch(err => {\n      Toast(err.message || err.msg || '????');\n      setTimeout(() => {\n        this.handleError(err);\n      }, 2000);\n    });\n  },\n\n  handleError(err) {\n    if (err.message === '请先填写问卷') {\n      // ??????\n      wx.switchTab({\n        url: '/pages/question/index'\n      });\n    } else if (err.message === '用户已经处于订阅状态，暂时不支持续费') {\n      wx.switchTab({\n        url: '/pages/box/index'\n      });\n    }\n  },\n\n  onShareAppMessage() {\n    return {\n      title: '爱戴小盒，快来看看吧!',\n      path: '/pages/entry/index',\n      imageUrl: 'http://static.wx.qiaqiabox.com/slice/share/1.jpeg'\n    };\n  }\n\n});",null]}