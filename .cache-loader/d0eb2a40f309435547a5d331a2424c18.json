{"remainingRequest":"/Users/jiachen/projects/shared_diary/node_modules/_babel-loader@8.0.6@babel-loader/lib/index.js!/Users/jiachen/projects/shared_diary/src/packages/address/list/index.js","dependencies":[{"path":"/Users/jiachen/projects/shared_diary/src/packages/address/list/index.js","mtime":1574680731942},{"path":"/Users/jiachen/projects/shared_diary/node_modules/_cache-loader@1.2.5@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/jiachen/projects/shared_diary/node_modules/_babel-loader@8.0.6@babel-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import { getImageUrl } from 'utils/image';\nimport { fetchData } from './api';\nimport { toCamelCase } from 'shared/utils/map-keys';\nimport Toast from 'vant-weapp/dist/toast/toast';\nconst app = getApp();\nPage({\n  data: {\n    icon1: '',\n    icon2: '',\n    userAddressList: []\n  },\n\n  onLoad(query = {}) {\n    const icon1 = getImageUrl('slice/location/icon_location.png');\n    const icon2 = getImageUrl('slice/location/icon_newlocation.png');\n    this.setData({\n      icon1,\n      icon2\n    });\n    this.init();\n\n    if (query.select) {\n      this.select = true;\n    }\n  },\n\n  onShow() {\n    if (app.globalData.refreshAddressList) {\n      this.init();\n      app.globalData.refreshAddressList = false;\n    }\n  },\n\n  init() {\n    this.limit = 20;\n    this.offset = 0;\n    this.fetching = false;\n    this.finished = false;\n    this.fetchAddress('fetch');\n  },\n\n  fetchAddress(type = 'fetch') {\n    if (type === 'fetch') {\n      this.offset = 0;\n      this.finished = false;\n    }\n\n    this.fetching = true;\n    type === 'fetch' && wx.showLoading({\n      title: '加载中...'\n    });\n    fetchData({\n      limit: this.limit,\n      offset: this.offset\n    }).then(res => {\n      let data = res.data.objects || [];\n\n      if (data.length < this.limit) {\n        this.finished = true;\n      } else {\n        this.offset = this.offset + this.limit;\n      }\n\n      const {\n        address\n      } = this.data;\n      const userAddressList = type === 'fetch' ? [...data] : [...address, ...data];\n      this.fetching = false;\n      this.setData({\n        userAddressList\n      });\n      type === 'fetch' && wx.hideLoading();\n    });\n  },\n\n  onEdit(e) {\n    const {\n      address\n    } = e.target.dataset;\n    wx.navigateTo({\n      url: '/packages/address/edit/index?address=' + JSON.stringify(address)\n    });\n  },\n\n  onDelete(e) {\n    const {\n      address\n    } = e.target.dataset;\n    const {\n      id\n    } = address;\n    zx.update('address', id, {\n      is_delete: 1\n    }).then(() => {\n      Toast.success({\n        message: '删除成功'\n      });\n      this.init();\n    }).catch(err => {\n      Toast.fail({\n        message: err.message || err.msg || '删除'\n      });\n    });\n  },\n\n  onCreate() {\n    wx.navigateTo({\n      url: '/packages/address/edit/index'\n    });\n  },\n\n  onClickAddress(e) {\n    if (!this.select) {\n      return;\n    }\n\n    const {\n      address\n    } = e.target.dataset;\n    const {\n      province,\n      city,\n      county,\n      address: addr,\n      phone,\n      name,\n      id\n    } = address;\n    const addressStr = province + city + county + addr;\n    const addressId = id;\n    const addressInfo = {\n      name,\n      phone,\n      address: addressStr\n    };\n    app.globalData.isSetAddress = true;\n    app.globalData.addressId = addressId;\n    app.globalData.addressInfo = addressInfo;\n    wx.navigateBack();\n  },\n\n  onShareAppMessage() {\n    return {\n      title: '??????????!',\n      path: '/pages/entry/index',\n      imageUrl: 'http://static.wx.qiaqiabox.com/slice/share/1.jpeg'\n    };\n  }\n\n});",null]}