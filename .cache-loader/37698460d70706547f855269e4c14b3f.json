{"remainingRequest":"/Users/jiachen/projects/shared_diary/node_modules/_babel-loader@8.0.6@babel-loader/lib/index.js!/Users/jiachen/projects/shared_diary/src/packages/wallet/index.js","dependencies":[{"path":"/Users/jiachen/projects/shared_diary/src/packages/wallet/index.js","mtime":1574666290470},{"path":"/Users/jiachen/projects/shared_diary/node_modules/_cache-loader@1.2.5@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/jiachen/projects/shared_diary/node_modules/_babel-loader@8.0.6@babel-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import { api, request } from 'utils/api';\nimport util from 'utils/util';\nimport Toast from 'vant-weapp/dist/toast/toast';\nimport { filterFetchData } from './utils';\nconst isIphoneX = util.isIphoneX();\nconst app = getApp();\nPage({\n  data: {\n    originCouponList: [],\n    couponList: [],\n    isIphoneX,\n    fetchCode: ''\n  },\n\n  onLoad(query = {}) {\n    this.init();\n\n    if (query.select) {\n      this.select = true;\n    }\n  },\n\n  init() {\n    this.fetchLock = false;\n    Toast.loading('加载中...');\n    request(api.coupon_list).then(res => {\n      const couponList = filterFetchData(res.coupon_list);\n      this.setData({\n        couponList,\n        fetchCode: '',\n        originCouponList: res.coupon_list\n      });\n      Toast.clear();\n    });\n  },\n\n  onFetchCodeInput(e) {\n    this.setData({\n      fetchCode: e.detail\n    });\n  },\n\n  onClickFetchCoupon() {\n    if (this.fetchLock) {\n      return;\n    }\n\n    if (!this.data.fetchCode) {\n      return Toast('请输入兑换码');\n    }\n\n    this.fetchLock = true;\n    Toast.loading('兑换中...');\n    request(api.coupon_exchange, {\n      code: this.data.fetchCode\n    }).then(() => {\n      Toast('兑换成功');\n      this.init();\n    }).catch(err => {\n      Toast(err.message || err.msg || '兑换失败');\n      this.fetchLock = false;\n    });\n  },\n\n  onClickCoupon(e) {\n    if (!this.select) {\n      return;\n    }\n\n    const {\n      index\n    } = e.currentTarget.dataset;\n    app.globalData.isSetCoupon = true;\n    app.globalData.coupon = this.data.originCouponList[index];\n    wx.navigateBack();\n  },\n\n  onShareAppMessage() {\n    return {\n      title: '爱戴小盒，快来看看吧!',\n      path: '/pages/entry/index',\n      imageUrl: 'http://static.wx.qiaqiabox.com/slice/share/1.jpeg'\n    };\n  }\n\n});",null]}