{"remainingRequest":"/Users/jiachen/projects/shared_diary/node_modules/_babel-loader@8.0.6@babel-loader/lib/index.js!/Users/jiachen/projects/shared_diary/src/utils/api.js","dependencies":[{"path":"/Users/jiachen/projects/shared_diary/src/utils/api.js","mtime":1574666290486},{"path":"/Users/jiachen/projects/shared_diary/node_modules/_cache-loader@1.2.5@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/jiachen/projects/shared_diary/node_modules/_babel-loader@8.0.6@babel-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import CONFIG from 'utils/config';\nimport _ from 'underscore';\nconst BASE_URL = CONFIG.baseUrl;\nexport const api = {\n  \"on_login\": {\n    desc: \"用户登录\",\n    url: `${BASE_URL}v1/user/on_login/`,\n    method: \"post\"\n  },\n  \"info\": {\n    desc: \"用户信息\",\n    url: `${BASE_URL}v1/user/info/`,\n    method: \"get\"\n  },\n  \"survey_info\": {\n    desc: \"加载提交过了的问卷\",\n    url: `${BASE_URL}v1/user/survey/info/`,\n    method: \"get\"\n  },\n  \"survey_submit\": {\n    desc: \"提交问卷\",\n    url: `${BASE_URL}v1/user/survey/submit/`,\n    method: \"post\"\n  },\n  \"get_coupon_for_subscribe\": {\n    desc: \"购买会员时输入打折码\",\n    url: `${BASE_URL}v1/user/coupon_for_subscribe/get`,\n    method: \"get\"\n  },\n  \"subscribe_pay\": {\n    desc: \"支付会员\",\n    url: `${BASE_URL}v1/user/subscribe/pay/`,\n    method: \"post\"\n  },\n  \"post_arrived\": {\n    desc: \"确认收货\",\n    url: `${BASE_URL}v1/user/post_arrived/`,\n    method: \"post\"\n  },\n  \"order_box\": {\n    desc: \"获取盒子信息\",\n    url: `${BASE_URL}v1/user/order/box/`,\n    method: \"get\"\n  },\n  \"pre_post_back\": {\n    // /api/v1/user/order/pre_post_back/:order_id\n    desc: \"预约寄回某产品\",\n    url: `${BASE_URL}v1/user/order/pre_post_back/`,\n    method: \"post\"\n  },\n  \"pre_post_back_cancel\": {\n    desc: \"取消预约寄回某产品\",\n    url: `${BASE_URL}v1/user/order/pre_post_back_cancel/`,\n    method: \"post\"\n  },\n  \"order_update\": {\n    // /api/v1/user/order/update/:order_id\n    desc: \"修改盒子信息\",\n    url: `${BASE_URL}v1/user/order/update/`,\n    method: \"post\"\n  },\n  \"order_post_back\": {\n    // /user/order/post_back/:order_id/:product_id/\n    desc: \"寄回某产品\",\n    url: `${BASE_URL}v1/user/order/post_back/`,\n    method: \"post\"\n  },\n  \"order_post_back_cancel\": {\n    // /user/order/post_back_cancel/:order_id/:product_id/\n    desc: \"取消寄回\",\n    url: `${BASE_URL}v1/user/order/post_back_cancel/`,\n    method: \"post\"\n  },\n  \"order_pay\": {\n    desc: \"支付盒子订单\",\n    url: `${BASE_URL}v1/user/order/pay/`,\n    method: \"post\"\n  },\n  \"order_feedback\": {\n    desc: \"订单结束后反馈信息\",\n    url: `${BASE_URL}v1/user/order/feedback/:order_id/`,\n    method: \"post\"\n  },\n  \"coupon_list\": {\n    desc: \"优惠券列表（我的钱包）\",\n    url: `${BASE_URL}v1/user/coupon/list/`,\n    method: \"get\"\n  },\n  \"coupon_exchange\": {\n    desc: \"优惠码兑换成券\",\n    url: `${BASE_URL}v1/user/coupon/exchange/`,\n    method: \"post\"\n  },\n  \"address_list\": {\n    desc: \"用户收件地址列表\",\n    url: `${BASE_URL}v1/user/address/list/`,\n    method: \"get\"\n  },\n  \"address_delete\": {\n    desc: \"用户收件地址删除\",\n    url: `${BASE_URL}v1/user/address/delete/`,\n    method: \"post\"\n  },\n  \"address_create\": {\n    desc: \"用户新增收件地址\",\n    url: `${BASE_URL}v1/user/address/create/`,\n    method: \"post\"\n  },\n  \"address_update\": {\n    desc: \"用户编辑收件地址\",\n    url: `${BASE_URL}v1/user/address/update/`,\n    method: \"post\"\n  },\n  \"phone_send_sm\": {\n    desc: \"用户发送手机验证码\",\n    url: `${BASE_URL}v1/user/phone/send_sm/`,\n    method: \"post\"\n  },\n  \"phone_bind\": {\n    desc: \"用户绑定手机\",\n    url: `${BASE_URL}v1/user/phone/bind/`,\n    method: \"post\"\n  },\n  \"phone_unbind\": {\n    desc: \"用户解绑手机\",\n    url: `${BASE_URL}v1/user/phone/unbind/`,\n    method: \"post\"\n  },\n  \"pay_nothing\": {\n    desc: \"支付盒子空订单\",\n    url: `${BASE_URL}v1/user/order/pay_nothing/`,\n    method: \"post\"\n  }\n};\nexport function request(options, data = {}) {\n  options = _.clone(options);\n\n  if (options.id !== undefined) {\n    // 只要传入了id，自动在url结尾加上id\n    options.url += String(options.id);\n    delete options.id;\n  } else if (options.ids !== undefined) {\n    options.ids.forEach(item => {\n      options.url += String(item) + '/';\n    });\n    delete options.ids;\n  }\n\n  console.log(options);\n  return new Promise((resolve, reject) => {\n    const header = {\n      'content-type': 'application/json'\n    };\n    const token = wx.getStorageSync('token');\n\n    if (token) {\n      header['Auth-Token'] = token;\n    }\n\n    wx.request({\n      header,\n      ...options,\n      data,\n\n      success(res) {\n        if (res.data.status !== 200) {\n          reject(res.data.error);\n        }\n\n        resolve(res.data.data);\n      },\n\n      fail(err) {\n        reject(err);\n      }\n\n    });\n  });\n}",null]}